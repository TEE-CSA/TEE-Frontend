<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>
    <h1 class="text">User Score: <span id="userScoreFib">500</span></h1>
    <h1 class="text">Amount Bet: <span id="betAmountFib">0</span></h1>

    <div id="track">
        <div class="lane">
            <span class="car-label" id="carLabel1">For Loop</span>
            <img class="race-car1" src="https://github.com/TEE-CSA/TEEBackend/assets/109186517/0fe7001f-0d2e-40fc-bdd1-9b82373862f5" alt="Car 1">
        </div>
        <div class="lane" style="top: 25%;">
            <span class="car-label" id="carLabel2">While Loop</span>
            <img class="race-car2" src="https://github.com/TEE-CSA/TEEBackend/assets/109186517/6d9bc8e3-8c8e-4854-8194-0b5fdacad24b" alt="Car 2">
        </div>
        <div class="lane" style="top: 50%;">
            <span class="car-label" id="carLabel3">Recursion</span>
            <img class="race-car3" src="https://github.com/TEE-CSA/TEEBackend/assets/109186517/3976c85c-ae57-43a0-9331-1e10bf51d29f" alt="Car 3">
        </div>
        <div class="lane1" style="top: 75%">
            <span class="car-label" id="carLabel4">Matrix</span>
            <img class="race-car4" src="https://github.com/TEE-CSA/TEEBackend/assets/109186517/7ad3a783-5957-4979-81c0-33619a9b4ef4" alt="Car 4">
        </div>
        <div class="finish">
            <span class="finish-text">Finish</span>
        </div>
    </div>

    <form id="lengthForm">
        <label for="length">Length of Fibonacci Numbers</label>
        <input type="number" id="length" min="1" value="1">
    </form>

    <button id="startButton" onclick="startFibonacciRace()">Start Fibonacci Race</button>
    <button id="resetButton" onclick="resetRace()">Reset Race</button>

    <script>
        let userScoreFib = 500; // Initial user score
        let betAmountFib = 0;   
        async function startFibonacciRace(selectedAlgorithm, result) {
            try {
                // Fetch algorithm times from the backend
                const length = document.getElementById('length').value;
                const response = await fetch(`http://localhost:8085/api/fibonacci/speeds?length=${length}`);
                const algorithmTimes = await response.json();

                // Calculate the duration for each algorithm
                const duration = 4000; // 4 seconds for animation
                const car1Duration = algorithmTimes["forLoopFibonacci"];
                const car2Duration = algorithmTimes["whileLoopFibonacci"];
                const car3Duration = algorithmTimes["recursionFibonacci"];
                const car4Duration = algorithmTimes["matrixFibonacci"];

                // Set the animation duration for each car
                document.querySelector(".race-car1").style.transitionDuration = car1Duration + "ms";
                document.querySelector(".race-car2").style.transitionDuration = car2Duration + "ms";
                document.querySelector(".race-car3").style.transitionDuration = car3Duration + "ms";
                document.querySelector(".race-car4").style.transitionDuration = car4Duration + "ms";

                // Start the race by applying the transform property
                document.querySelector(".race-car1").style.transform = "translateX(970px)";
                document.querySelector(".race-car2").style.transform = "translateX(970px)";
                document.querySelector(".race-car3").style.transform = "translateX(970px)";
                document.querySelector(".race-car4").style.transform = "translateX(970px)";
            } catch (error) {
                console.error('Error fetching algorithm times:', error);
            }
        }

        function resetRace() {
            // Reset the race by setting the transform property back to the initial position
            document.querySelector(".race-car1").style.transform = "translateX(0)";
            document.querySelector(".race-car2").style.transform = "translateX(0)";
            document.querySelector(".race-car3").style.transform = "translateX(0)";
            document.querySelector(".race-car4").style.transform = "translateX(0)";
        }

        async function placeBetFib() {
            const betInput = parseInt(document.getElementById("fibBetInput").value);
            if (isNaN(betInput) || betInput <= 0 || betInput > userScoreFib) {
                alert("Invalid bet amount");
                return;
            }

            // Update bet amount display
            betAmountFib = betInput;
            document.getElementById("betAmountFib").textContent = betAmountFib;

            // Fetch bet results
            try {
                const response = await fetch(`http://localhost:8085/api/fibonacci/bet?betAmount=${betAmountFib}&startingPoints=${userScoreFib}`);
                const result = await response.json();

                // Update user score
                userScoreFib = result.newScore;
                document.getElementById("userScoreFib").textContent = userScoreFib;

                // Start race with result
                startFibonacciRace(result.selectedAlgorithm, result);
            } catch (error) {
                console.error('Error placing bet:', error);
            }

            setTimeout(() => {
                alert(`Race finished! Winning algorithm: ${selectedAlgorithm}. ${result.didUserWin ? 'You won!' : 'You lost.'} Fun Fact: ${result.funFact}`);
                // Update UI elements if needed
            }, Math.max(car1Duration, car2Duration, car3Duration, car4Duration));
}

    </script>
</body>
</html>